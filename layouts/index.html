{{ $translation := ( index $.Site.Data.translations .Site.Language.Lang ) }}
{{ partial "head.html" . }}

<body class="page-vote">


  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TDRBDKS" height="0" width="0"
      style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  {{ partial "header.html" . }}

  <main class="page-vote-main" id="main">

    <div class="bg-blue css-arrow">
      <div class="grid-container">
        <div class="grid-row grid-gap">
          <div class="tablet:grid-col-4">
            <div class="site-logo" data-test="vote-logo" aria-label="Vote.gov">
              <div class="logo-text">{{ replace .Site.Params.Owner "%Vote.gov%" "Vote.gov" }}</div>
              <div id="SiteLogo">{{ partial "ballot_box-blue.html" . }}</div>
            </div>
          </div>
          <div id="skip-target" class="tablet:grid-col-8 right-shift">
            <section class="register align-bottom" role="region" aria-label="{{ $translation.homepage.header }}">
              <header>
                <h1 class="main-heading" data-test="main-header">{{ $translation.homepage.header | safeHTML }}</h1>
              </header>

              <form id="state-combo-box">
                <h2>{{ $translation.homepage.state_selection__heading }}</h2>
                <div class="input-buttons-group">
                <input class="state-input" list="states" id="state-input" autocomplete="off" 
                  onfocus="stateListVisible()" onblur="stateListVisible()" onkeyup="filterStateList()">
                  <div class="input-control-container">
                    <button class="reset-btn" type="reset" alt="Clear the search form"></button>
                    <button 
                      class="dropdown-btn" type="button"
                      onclick="stateListVisible()" onblur="stateListVisible()"></button>
                    <span class="btn-divider"></span>
                  </div>
                </div>
                <div id="filtered-states-list" class="usa-language__submenu" style="display: none;">
                    <ul id="state-list-results" class="usa-language__submenu__list">
                      {{ $states := where .Site.RegularPages.ByTitle "Section" .Site.Params.register_path }}
                      {{ range ($states.ByParam "state_name") }}
                      <li class="usa-language__submenu-item">
                        <a key="{{ .Params.state_abbreviation | lower }}" href="">{{ .Params.state_name }}</a>
                      </li>
                    {{ end }}
                    </ul>
                </div>
              </form>

            </section>
          </div>
        </div>
      </div>
    </div>

    <div class="bg-lightblue">
      <div class="grid-container accordion homepage-acc">
        <div class="grid-row grid-gap">
          <div class="tablet:grid-col-4">

          </div>
          <div class="tablet:grid-col-8 right-shift">
   
              {{ partial "accordion-group.html" . }}

            <section class="page-section registered" aria-label="{{ $translation.homepage.registered__header }}">
              <header>
                <h2 class="content-heading">{{ $translation.homepage.registered__header }}</h2>
              </header>
              <div class="voter-resources">
                <h3>
                  {{ $resources_intro := replace $translation.homepage.registered__resources_intro "%USA.gov%" "USA.gov" }}
                  {{ replace $resources_intro "%link%" (partial "links/homepage-registration-link.html" .)|safeHTML }}:
                </h3>
                <ul class="registered-resources">
                  {{ if $translation.homepage.registered_links__absentee_url }}
                  <li><a
                    href="{{ $translation.homepage.registered_links__absentee_url }}">{{ $translation.homepage.registered_links__absentee }}</a>
                </li>
                {{ end }}
                <li><a
                    href="{{ $translation.homepage.registered_links__electionday_url }}">{{ $translation.homepage.registered_links__electionday }}</a>
                </li>
                <li><a
                    href="{{ $translation.homepage.registered_links__voterid_url }}">{{ $translation.homepage.registered_links__voterid }}</a>
                </li>
                <li><a
                    href="{{ $translation.homepage.registered_links__process_url }}">{{ $translation.homepage.registered_links__process }}</a>
                </li>
                </ul>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer BEGIN -->
  {{ partial "footer.html" . }}
  <!-- Footer END -->

  <script type="text/javascript">
    document.getElementById('register').onsubmit = function (ev) {
      var stateSelected = document.getElementById('js-user-selection').value;
      if (stateSelected === 'default') {
        return false;
      } else {
        ev.preventDefault();
        // var redirectURL = window.location.protocol + '//' + window.location.host + '/{{ .Site.Params.root_path }}register/';
        var redirectURL = '{{ .Site.Home.RelPermalink }}{{ .Site.Params.register_path }}/';
        redirectURL = redirectURL + stateSelected + '/';
        window.location.href = redirectURL;
      }
    };

    function filterStateList() {
      var input, filter, ul, li, a, i, txtValue;
      input = document.getElementById("state-input");
      filter = input.value.toUpperCase();
      ul = document.getElementById("state-list-results");
      li = ul.getElementsByTagName("li");
      for (i = 0; i < li.length; i++) {
          a = li[i].getElementsByTagName("a")[0];
          txtValue = a.textContent || a.innerText;
          if (txtValue.toUpperCase().indexOf(filter) > -1) {
              li[i].style.display = "";
          } else {
              li[i].style.display = "none";
          }
      }
    }

    function stateListVisible() {
      var x = document.getElementById("filtered-states-list");
      if (x.style.display === "none") {
        x.style.display = "block";
      } else {
        x.style.display = "none";
      }
    }
  </script>

  {{ partial "analytics.html" . }}
  {{ partial "scripts.html" . }}


</body>

</html>
