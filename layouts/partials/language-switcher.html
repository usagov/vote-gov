{{ $state := .Params.state_abbreviation | lower }}
{{ $currentLang := .Site.Language.LanguageName }}
<div class="translations">
  <label for="language-switcher" class="usa-label usa-label--language">{{ replace .Site.Params.select_language "%dropdown-list%" "" }}</label>
  <select class="usa-select usa-select--language"  data-test="language-switcher" name="language-switcher" id="language-switcher" onchange="window.location=this.value;">
    {{ range $.Site.Home.AllTranslations }}
    <option value="{{ .RelPermalink }}{{ if not ($.IsHome) }}{{ .Site.Params.register_path }}/{{ $state }}{{ end }}"{{ if eq $currentLang .Language.LanguageName }} selected="selected"{{ end }}>
  {{ if lt (len .Translations) 2 }}
  {{ range .Translations }}
  <a lang="{{ .Language.Lang | replaceRE "-[a-z]+" "" }}" href="{{ .Permalink | relURL }}" class="usa-button translation-link">
    {{ .Language.LanguageName }}
  </a>
  {{ end }}
  {{ else }}
  <label for="language-switcher" class="usa-label usa-label--language">{{ replace .Site.Params.select_language "%dropdown-list%" "" }}</label>
  <select class="usa-select usa-select--language" name="language-switcher" id="language-switcher" onchange="window.location=this.value;">
    <option lang="{{ .Language.Lang | replaceRE "-[a-z]+" "" }}" value="{{ .Permalink | relURL }}"{{ if eq $currentLang .Language.LanguageName }} selected="selected"{{ end }}>
      {{ .Language.LanguageName }} {{ if not (eq .Site.Params.english_languageName "") }}({{ .Site.Params.english_languageName }}){{ end }}
    </option>
    {{ range .Translations }}
    <option lang="{{ .Language.Lang | replaceRE "-[a-z]+" "" }}" value="{{ .Permalink | relURL }}"{{ if eq $currentLang .Language.LanguageName }} selected="selected"{{ end }}>
      {{ .Language.LanguageName }} {{ if not (eq .Site.Params.english_languageName "") }}({{ .Site.Params.english_languageName }}){{ end }}
    </option>
    {{ end }}
  </select>
</div>
